#!/bin/bash

# According to the man page of man itself, MANPAGER doesn't support
# pipes and stuff, and suggests a wrapper script instead. This
# is that script.

# Test for vim in $VISUAL, use it if it is
if [ -n "$VISUAL" ] ; then # && [ "$VISUAL" != "${VISUAL%/vim}" ] ; then
    # This is the most compatible, but prints "Vim: Reading from stdin..."
    #exec col -b -x | $VISUAL -M +MANPAGER -Rn -c 'set ft=man' -

    NOTERM=""

    if [ "$VISUAL" != "${VISUAL%/vim}" ] ; then
        # Vim-specific
        NOTERM="--not-a-term"
    fi
    exec col -b -x | $VISUAL -M -Rn -c 'set ft=man' $NOTERM -

    # This avoids that message, but is less compatible, and also breaks Ctrl-O/T navigation
    #exec bash -c "$VISUAL -Rn -c 'set ft=man' </dev/tty <(col -b -x)"
else
    exec $PAGER ${1+"$@"}
fi
